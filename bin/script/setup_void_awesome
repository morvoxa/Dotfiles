#!/bin/sh
set -e

echo ">> Setup repo TUNA"
cat > /etc/xbps.d/00-repository-main.conf <<EOF
repository=https://mirrors.tuna.tsinghua.edu.cn/voidlinux/current
EOF

sleep 2
xbps-install -Syy

echo ">> Installing main packages"
xbps-install -Sy \
  awesome fastfetch picom rofi alacritty \
  starship zsh tmux fzf git \
  noto-fonts-ttf noto-fonts-emoji twemoji \
  unzip curl wget rsync lsd \
  NetworkManager dbus alsa-utils

echo ">> Enable services"
mkdir -p /var/service

enable_service() {
  svc="$1"
  if [ -L "/var/service/$svc" ]; then
    echo "Service $svc already enabled"
  else
    ln -s "/etc/sv/$svc" "/var/service/$svc"
    echo "Service $svc enabled"
  fi
}

enable_service NetworkManager
enable_service dbus
enable_service alsa

./bin/script/xlibre_void

echo ">> Done"
